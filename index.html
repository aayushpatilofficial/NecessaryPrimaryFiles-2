<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Scientrix ‚Äî Sustainable Futures</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
:root{--bg:#ffffff;--surface:#f8f9fa;--border:#e0e4e8;--text:#1a1d23;--text-muted:#6b7280;--accent:#0066ff;--accent-hover:#0052cc;--success:#10b981;--warning:#f59e0b;--danger:#ef4444;--maxw:1200px}
[data-theme="dark"]{--bg:#0a0e1a;--surface:#151925;--border:#1f2937;--text:#f9fafb;--text-muted:#9ca3af;--accent:#3b82f6;--accent-hover:#60a5fa}
*{box-sizing:border-box;margin:0;padding:0}html{scroll-behavior:smooth}body{min-height:100vh;background:var(--bg);color:var(--text);font-family:'Inter',system-ui,-apple-system,sans-serif;line-height:1.6;transition:background 0.3s, color 0.3s}.container{max-width:var(--maxw);margin:0 auto;padding:20px}.topbar{position:fixed;top:0;left:0;right:0;background:var(--bg);border-bottom:1px solid var(--border);z-index:100;backdrop-filter:blur(8px);background:rgba(255,255,255,0.95)}[data-theme="dark"] .topbar{background:rgba(10,14,26,0.95)}.nav{max-width:var(--maxw);margin:0 auto;padding:16px 20px;display:flex;align-items:center;justify-content:space-between;gap:20px}.nav-left{display:flex;align-items:center;gap:16px}.logo{width:40px;height:40px;background:var(--accent);color:#fff;display:grid;place-items:center;font-weight:800;border-radius:8px;font-size:1.1rem}.brand-text{font-weight:700;font-size:1.05rem;color:var(--text)}.nav-links{display:flex;gap:4px;align-items:center;flex-wrap:wrap}.nav-links a{padding:8px 14px;color:var(--text-muted);font-weight:500;border-radius:6px;transition:all 0.2s;font-size:0.95rem;text-decoration:none;cursor:pointer}.nav-links a:hover{background:var(--surface);color:var(--text)}.nav-links a.btn-primary{background:var(--accent);color:#fff;font-weight:600}.nav-links a.btn-primary:hover{background:var(--accent-hover)}.theme-toggle{width:40px;height:40px;border:1px solid var(--border);background:var(--surface);border-radius:8px;cursor:pointer;display:grid;place-items:center;transition:all 0.2s;font-size:1.2rem}.theme-toggle:hover{background:var(--bg);border-color:var(--accent)}.section{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:32px;margin:20px 0}main{margin-top:80px}.hero{margin-bottom:24px}.hero .eyebrow{color:var(--accent);font-weight:600;font-size:0.9rem;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}.hero h1{font-size:2.8rem;font-weight:800;margin-bottom:12px;line-height:1.1}.hero .lead{font-size:1.1rem;color:var(--text-muted);margin-bottom:16px}.badge{display:inline-block;padding:8px 16px;background:var(--accent);color:#fff;border-radius:6px;font-weight:600;font-size:0.9rem}.countdown{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-top:24px}.countdown .unit{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:20px;text-align:center}.unit .num{font-size:2.5rem;font-weight:800;color:var(--accent);line-height:1}.unit .lbl{font-size:0.85rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;margin-top:8px}h2{font-size:1.8rem;font-weight:700;margin-bottom:20px;color:var(--text)}.rules-list{list-style:none;padding:0}.rules-list li{padding:16px;margin:12px 0;background:var(--bg);border-left:3px solid var(--accent);border-radius:4px}.rules-list strong{color:var(--accent);font-weight:600}.schedule{display:grid;gap:12px;margin-top:20px}.schedule-item{display:grid;grid-template-columns:140px 1fr auto;gap:16px;align-items:center;padding:16px 20px;background:var(--bg);border:1px solid var(--border);border-radius:8px;transition:all 0.2s}.schedule-item:hover{border-color:var(--accent);box-shadow:0 2px 8px rgba(0,0,0,0.05)}.schedule-item .time{font-weight:700;color:var(--accent);font-size:0.95rem}.schedule-item .desc{font-weight:500;color:var(--text)}.countdown-event{font-size:0.8rem;color:var(--text-muted);padding:6px 12px;background:var(--surface);border-radius:4px;white-space:nowrap;border:1px solid var(--border)}.btn-group{display:flex;gap:12px;flex-wrap:wrap;margin-top:20px}.btn{padding:12px 24px;background:var(--accent);color:#fff;border:none;border-radius:8px;font-weight:600;text-decoration:none;display:inline-flex;align-items:center;gap:8px;cursor:pointer;transition:all 0.2s;font-size:0.95rem;justify-content:center}.btn:hover{background:var(--accent-hover);transform:translateY(-1px)}.btn-success{background:var(--success)}.btn-success:hover{background:#059669}.contact-grid{display:grid;gap:20px;margin-top:20px}.contact-item h3{font-size:1.1rem;margin-bottom:12px;font-weight:600}.contact-btn{display:inline-flex;align-items:center;gap:10px;padding:12px 20px;background:var(--success);color:#fff;border-radius:8px;font-weight:600;text-decoration:none;transition:all 0.2s}.contact-btn:hover{background:#059669;transform:translateY(-1px)}.note{margin-top:20px;padding:16px 20px;background:var(--bg);border-left:4px solid var(--accent);border-radius:4px;color:var(--text-muted)}.note strong{color:var(--accent)}footer{text-align:center;padding:32px 20px;color:var(--text-muted);font-size:0.9rem;border-top:1px solid var(--border);margin-top:40px}#overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:200;opacity:0;transition:opacity 0.3s}.popup{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0.95);z-index:201;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:32px;max-width:600px;width:90%;max-height:85vh;overflow-y:auto;opacity:0;transition:all 0.3s;box-shadow:0 20px 60px rgba(0,0,0,0.3)}.popup h2{margin-bottom:8px}.popup .lead{color:var(--text-muted);margin-bottom:20px;font-size:0.95rem}.popup input,.popup select,.popup textarea{width:100%;padding:12px 16px;margin:8px 0;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.95rem;font-family:'Inter',sans-serif;transition:border 0.2s}.popup input:focus,.popup select:focus,.popup textarea:focus{outline:none;border-color:var(--accent)}.popup button{width:100%;margin-top:12px}.btn-cancel{background:#6b7280}.btn-cancel:hover{background:#4b5563}#welcome-modal{max-width:700px}.welcome-content{text-align:center}.welcome-icon{font-size:4rem;margin-bottom:16px}.welcome-content h1{font-size:2.5rem;margin-bottom:16px;background:linear-gradient(135deg, var(--accent), var(--accent-hover));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.feature-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin:24px 0;text-align:left}.feature-card{padding:16px;background:var(--bg);border:1px solid var(--border);border-radius:8px}.feature-card .icon{font-size:1.8rem;margin-bottom:8px}.feature-card h3{font-size:1rem;margin-bottom:4px;font-weight:600}.feature-card p{font-size:0.85rem;color:var(--text-muted)}.check-in-code{display:flex;gap:8px;align-items:center;margin:16px 0}.check-in-code input{flex:1;margin:0}.status-badge{display:inline-block;padding:6px 12px;border-radius:6px;font-size:0.85rem;font-weight:600;margin-top:12px}.status-success{background:rgba(16,185,129,0.1);color:var(--success);border:1px solid var(--success)}.status-error{background:rgba(239,68,68,0.1);color:var(--danger);border:1px solid var(--danger)}.registration-details{margin-top:20px;padding:20px;background:var(--bg);border:1px solid var(--border);border-radius:8px}.detail-row{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--border)}.detail-row:last-child{border-bottom:none}.detail-label{font-weight:600;color:var(--text-muted)}.detail-value{font-weight:600;color:var(--text)}.admin-controls{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:20px}.stat-card{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:20px;text-align:center}.stat-card .num{font-size:2rem;font-weight:800;color:var(--accent)}.stat-card .label{font-size:0.9rem;color:var(--text-muted);margin-top:4px}.table-container{overflow-x:auto;margin-top:20px}table{width:100%;border-collapse:collapse;background:var(--bg);border:1px solid var(--border);border-radius:8px;overflow:hidden}th,td{padding:12px 16px;text-align:left;border-bottom:1px solid var(--border)}th{background:var(--surface);font-weight:600;color:var(--text)}tr:last-child td{border-bottom:none}tr:hover{background:var(--surface)}.action-btns{display:flex;gap:8px;flex-wrap:wrap}.btn-sm{padding:6px 12px;font-size:0.85rem;min-width:auto;width:auto}.qr-display{text-align:center;padding:20px;margin:20px 0}.qr-code{display:inline-block;padding:20px;background:#fff;border-radius:12px;margin:16px 0}.registration-code{font-size:2rem;font-weight:800;color:var(--accent);letter-spacing:4px;margin:16px 0;font-family:monospace}@media (max-width:768px){.nav{flex-wrap:wrap;padding:12px 16px}.nav-links{order:3;width:100%;margin-top:8px;justify-content:flex-start}.hero h1{font-size:2rem}.countdown{grid-template-columns:repeat(2,1fr);gap:12px}.unit{padding:16px}.unit .num{font-size:2rem}.schedule-item{grid-template-columns:1fr;gap:8px}.countdown-event{width:fit-content}.btn-group{flex-direction:column}.btn{width:100%;justify-content:center}.section{padding:24px 20px}.popup{padding:24px}.check-in-code{flex-direction:column}.check-in-code input{width:100%}.admin-controls{grid-template-columns:1fr}.feature-grid{grid-template-columns:1fr}.welcome-content h1{font-size:1.8rem}}@media (max-width:480px){.brand-text{font-size:0.9rem}.logo{width:36px;height:36px;font-size:1rem}.detail-row{flex-direction:column;gap:4px}}
</style>
</head>
<body data-theme="dark">
<div class="topbar">
  <nav class="nav">
    <div class="nav-left">
      <div class="logo">ST</div>
      <div class="brand-text">Scientrix ‚Äî LSA</div>
    </div>
    <div class="nav-links">
      <a href="#about">Home</a>
      <a href="#rules">Rules</a>
      <a href="#schedule">Schedule</a>
      <a href="#checkin">Check-in</a>
      <a href="#contact">Contact</a>
      <a href="#" class="btn-primary" onclick="event.preventDefault();showPopup('register-popup')">Register</a>
    </div>
    <button class="theme-toggle" id="theme-toggle" title="Toggle theme">
      <span id="theme-icon">üåô</span>
    </button>
  </nav>
</div>

<main class="container">
  <section id="about" class="section hero">
    <div class="eyebrow">Welcome to Scientrix</div>
    <h1>Sustainable Futures</h1>
    <p class="lead">Organized by <strong>Little Scholars' Academy</strong>. A science exhibition focused on innovation, sustainability, and practical solutions for tomorrow's challenges.</p>
    <span class="badge">Theme: Sustainable Futures</span>
    <div class="countdown" id="main-countdown">
      <div class="unit"><div class="num" id="days">0</div><div class="lbl">Days</div></div>
      <div class="unit"><div class="num" id="hours">0</div><div class="lbl">Hours</div></div>
      <div class="unit"><div class="num" id="minutes">0</div><div class="lbl">Minutes</div></div>
      <div class="unit"><div class="num" id="seconds">0</div><div class="lbl">Seconds</div></div>
    </div>
  </section>

  <section id="rules" class="section">
    <h2>Rules & Regulations</h2>
    <ul class="rules-list">
      <li><strong>Eligibility:</strong> Open to students in recognized schools. Teams of up to 3 members. One project per team/individual.</li>
      <li><strong>Registration:</strong> Complete registration form with accurate details. Confirmation upon form submission. Strict deadline enforcement.</li>
      <li><strong>Project Guidelines:</strong> Must align with "Sustainable Futures" theme. Original work only. Any science/tech branch. Must be working model. Safety protocols mandatory.</li>
      <li><strong>Judging Criteria:</strong> Evaluated on originality, scientific accuracy, presentation clarity, theme relevance, and practical applicability.</li>
      <li><strong>Conduct:</strong> Respectful behavior required. Cheating/misrepresentation leads to disqualification. Adhere to all timelines.</li>
      <li><strong>Awards:</strong> Certificates for all participants. Category prizes. Winning projects featured on official platforms.</li>
      <li><strong>Miscellaneous:</strong> Organizers reserve right to modify rules. Judges' decisions are final.</li>
    </ul>
  </section>

  <section id="schedule" class="section">
    <h2>Event Schedule</h2>
    <p style="color:var(--text-muted);margin-bottom:16px">November 11, 2025</p>
    <div class="schedule">
      <div class="schedule-item" data-time="2025-11-11T10:00:00"><div class="time">10:00‚Äì10:30</div><div class="desc">Reporting & Registration</div><div class="countdown-event"></div></div>
      <div class="schedule-item" data-time="2025-11-11T10:30:00"><div class="time">10:30‚Äì11:00</div><div class="desc">Inauguration Ceremony</div><div class="countdown-event"></div></div>
      <div class="schedule-item" data-time="2025-11-11T11:00:00"><div class="time">11:00‚Äì12:15</div><div class="desc">Project Exhibition ‚Äî Round 1</div><div class="countdown-event"></div></div>
      <div class="schedule-item" data-time="2025-11-11T12:15:00"><div class="time">12:15‚Äì12:45</div><div class="desc">Interactive Science Activity / Quiz</div><div class="countdown-event"></div></div>
      <div class="schedule-item" data-time="2025-11-11T12:45:00"><div class="time">12:45‚Äì13:15</div><div class="desc">Lunch Break</div><div class="countdown-event"></div></div>
      <div class="schedule-item" data-time="2025-11-11T13:15:00"><div class="time">13:15‚Äì14:30</div><div class="desc">Project Exhibition ‚Äî Round 2</div><div class="countdown-event"></div></div>
      <div class="schedule-item" data-time="2025-11-11T14:30:00"><div class="time">14:30‚Äì15:00</div><div class="desc">Workshop / Special Session</div><div class="countdown-event"></div></div>
      <div class="schedule-item" data-time="2025-11-11T15:00:00"><div class="time">15:00‚Äì15:30</div><div class="desc">Judges Deliberation</div><div class="countdown-event"></div></div>
      <div class="schedule-item" data-time="2025-11-11T15:30:00"><div class="time">15:30‚Äì16:00</div><div class="desc">Prize Distribution & Closing</div><div class="countdown-event"></div></div>
    </div>
    <div class="btn-group">
      <a href="https://drive.google.com/file/d/18xUeHWsEmAVexVLMnTDXAx1iwAg_vR0r/view?usp=sharing" class="btn">üìÑ Download Schedule</a>
      <a href="https://drive.google.com/file/d/1ZHRYNJwWCZHgIf6_9UiUHvlz52RkAxza/view?usp=sharing" class="btn">üìã Download Rules</a>
    </div>
  </section>

  <section id="checkin" class="section">
    <h2>Event Check-in</h2>
    <p class="lead">Enter your registration code to check-in or view your registration details.</p>
    <div class="check-in-code">
      <input type="text" id="checkin-code" placeholder="Enter Registration Code (e.g., ST2025-ABC123)" maxlength="15">
      <button class="btn" onclick="checkIn()">üîç Check-in</button>
    </div>
    <div id="checkin-result"></div>
  </section>

  <section id="contact" class="section">
    <h2>Contact Information</h2>
    <div class="contact-grid">
      <div class="contact-item">
        <h3>Event Queries</h3>
        <a href="https://wa.me/+919480172376" class="contact-btn">üí¨ Pranavkumar Math<br>+91 94801 72376</a>
      </div>
      <div class="contact-item">
        <h3>Website Support</h3>
        <a href="https://wa.me/+918217575558" class="contact-btn">üí¨ Aayush Patil<br>+91 8217575558</a>
      </div>
      <div class="contact-item">
        <h3>WhatsApp Group</h3>
        <a href="https://chat.whatsapp.com/Gv28uUu1VCDBenwCiwcHjG" class="contact-btn btn-success">üë• Join Group</a>
      </div>
    </div>
    <div class="note">All confirmations should be sent to <strong>Pranavkumar Math (+91 9480172376)</strong></div>
  </section>

  <section id="admin" class="section" style="display:none">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:12px">
      <h2 style="margin:0">Admin Panel</h2>
      <button class="btn btn-cancel btn-sm" onclick="logoutAdmin()">Logout</button>
    </div>
    <div class="admin-controls">
      <div class="stat-card"><div class="num" id="total-registrations">0</div><div class="label">Total Registrations</div></div>
      <div class="stat-card"><div class="num" id="checked-in">0</div><div class="label">Checked In</div></div>
      <div class="stat-card"><div class="num" id="pending-checkin">0</div><div class="label">Pending Check-in</div></div>
    </div>
    <div class="table-container">
      <table id="admin-table">
        <thead><tr><th>Code</th><th>School</th><th>Team Lead</th><th>Contact</th><th>Status</th></tr></thead>
        <tbody id="admin-tbody"></tbody>
      </table>
    </div>
  </section>
</main>

<footer>
  <p>¬© 2025 Scientrix ‚Äî Little Scholars Academy. All rights reserved.</p>
  <p style="margin-top:8px;font-size:0.85rem"><a href="#" onclick="showAdminLogin();return false" style="color:var(--text-muted);cursor:pointer">Admin</a></p>
</footer>

<div id="overlay"></div>

<div id="welcome-modal" class="popup">
  <div class="welcome-content">
    <div class="welcome-icon">üéâ</div>
    <h1>You're Invited!</h1>
    <p class="lead">Welcome to Scientrix ‚Äî Sustainable Futures 2025</p>
    <div class="feature-grid">
      <div class="feature-card"><div class="icon">üìù</div><h3>Easy Registration</h3><p>Register your team and get instant confirmation</p></div>
      <div class="feature-card"><div class="icon">üé´</div><h3>Unique Code</h3><p>Receive a unique registration code for check-in</p></div>
      <div class="feature-card"><div class="icon">‚úÖ</div><h3>Quick Check-in</h3><p>Fast check-in on event day with your code</p></div>
      <div class="feature-card"><div class="icon">üìä</div><h3>Track Progress</h3><p>View schedule and track your registration</p></div>
    </div>
    <button class="btn btn-success" onclick="closeWelcome()">Get Started ‚Üí</button>
    <p style="margin-top:16px;font-size:0.85rem;color:var(--text-muted)"><label style="cursor:pointer"><input type="checkbox" id="dont-show-again" style="width:auto;margin:0 4px 0 0">Don't show this again</label></p>
  </div>
</div>

<div id="register-popup" class="popup">
  <h2>Event Registration</h2>
  <p class="lead">Fill in all details carefully. You'll receive a unique registration code.</p>
  <form id="register-form" onsubmit="handleRegistration(event)">
    <input type="text" name="school_name" placeholder="School Name" required>
    <input type="text" name="participant1" placeholder="Team Lead / Participant 1 (Full Name)" required>
    <input type="text" name="participant2" placeholder="Participant 2 (Full Name)">
    <input type="text" name="participant3" placeholder="Participant 3 (Optional)">
    <input type="text" name="project_title" placeholder="Project Title" required>
    <select name="category" required>
      <option value="">Select Category</option>
      <option value="junior">Junior (Grades 6-8)</option>
      <option value="senior">Senior (Grades 9-12)</option>
    </select>
    <input type="text" name="registrant_name" placeholder="Registrant Name" required>
    <input type="tel" name="registrant_contact" placeholder="Registrant Contact Number" required>
    <input type="tel" name="participant_contact" placeholder="Team Lead Contact Number" required>
    <input type="email" name="email" placeholder="Email Address" required>
    <textarea name="project_desc" placeholder="Brief Project Description (Optional)" rows="3"></textarea>
    <button type="submit" class="btn btn-success">Submit Registration</button>
    <button type="button" class="btn btn-cancel" onclick="closePopup('register-popup')">Cancel</button>
  </form>
</div>

<div id="success-popup" class="popup">
  <div class="qr-display">
    <h2>üéâ Registration Successful!</h2>
    <p class="lead">Your unique registration code:</p>
    <div class="registration-code" id="generated-code">ST2025-XXXXXX</div>
    <div class="qr-code" id="qr-container"><canvas id="qr-canvas" width="200" height="200"></canvas></div>
    <p style="color:var(--text-muted);margin:16px 0">Save this code! You'll need it for check-in on event day.</p>
    <div class="btn-group">
      <button class="btn" onclick="downloadQR()">üíæ Download QR Code</button>
      <button class="btn" onclick="shareCode()">üì± Share via WhatsApp</button>
      <button class="btn btn-success" onclick="closePopup('success-popup')">Done</button>
    </div>
  </div>
</div>

<div id="admin-login-popup" class="popup">
  <h2>Admin Login</h2>
  <p class="lead">Enter admin credentials to access the dashboard.</p>
  <input type="password" id="admin-password" placeholder="Admin Password">
  <button class="btn btn-success" onclick="loginAdmin()">Login</button>
  <button class="btn btn-cancel" onclick="closePopup('admin-login-popup')">Cancel</button>
</div>

<script>
// ‚ö†Ô∏è REPLACE THIS WITH YOUR GOOGLE APPS SCRIPT URL
const SHEETS_API_URL = 'https://script.google.com/macros/s/AKfycbxwiffOb-KNxyMJ6hlkpt_8EIHe4rIu-P_du2uFUJrYERULcFOWIJQG79vibQ0DZIbU/exec';
const ADMIN_PASSWORD = 'scientrix2025';

function generateCode() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let code = 'ST2025-';
  for(let i = 0; i < 6; i++) {
    code += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return code;
}

function generateQR(text) {
  const canvas = document.getElementById('qr-canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = 200;
  canvas.height = 200;
  ctx.fillStyle = '#fff';
  ctx.fillRect(0, 0, 200, 200);
  ctx.fillStyle = '#000';
  ctx.font = 'bold 16px monospace';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(text, 100, 100);
  ctx.strokeStyle = '#000';
  ctx.lineWidth = 4;
  ctx.strokeRect(0, 0, 200, 200);
}

const themeToggle = document.getElementById('theme-toggle');
const themeIcon = document.getElementById('theme-icon');
const body = document.body;

const savedTheme = localStorage.getItem('theme') || 'dark';
body.setAttribute('data-theme', savedTheme);
themeIcon.textContent = savedTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';

themeToggle.addEventListener('click', () => {
  const currentTheme = body.getAttribute('data-theme');
  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
  body.setAttribute('data-theme', newTheme);
  localStorage.setItem('theme', newTheme);
  themeIcon.textContent = newTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
});

const eventStart = new Date('2025-11-11T08:00:00');
function updateMainCountdown(){
  const now = new Date();
  let diff = Math.max(0, eventStart - now);
  const days = Math.floor(diff/86400000);
  diff %= 86400000;
  const hours = Math.floor(diff/3600000);
  diff %= 3600000;
  const mins = Math.floor(diff/60000);
  const secs = Math.floor(diff/1000) % 60;
  document.getElementById('days').textContent = days;
  document.getElementById('hours').textContent = hours;
  document.getElementById('minutes').textContent = mins;
  document.getElementById('seconds').textContent = secs;
}
setInterval(updateMainCountdown, 1000);
updateMainCountdown();

function updateEventCountdowns(){
  const now = new Date();
  document.querySelectorAll('.schedule-item').forEach(item => {
    const startTime = new Date(item.dataset.time);
    const diff = Math.max(0, startTime - now);
    const hrs = Math.floor(diff/3600000);
    const mins = Math.floor((diff%3600000)/60000);
    const secs = Math.floor((diff%60000)/1000);
    const el = item.querySelector('.countdown-event');
    if(diff > 0){
      el.textContent = `${hrs}h ${mins}m ${secs}s`;
    } else {
      el.textContent = 'Completed';
    }
  });
}
setInterval(updateEventCountdowns, 1000);
updateEventCountdowns();

const overlay = document.getElementById('overlay');

function showPopup(popupId) {
  const popup = document.getElementById(popupId);
  overlay.style.display = 'block';
  popup.style.display = 'block';
  setTimeout(() => {
    overlay.style.opacity = '1';
    popup.style.opacity = '1';
    popup.style.transform = 'translate(-50%,-50%) scale(1)';
  }, 10);
}

function closePopup(popupId) {
  const popup = document.getElementById(popupId);
  popup.style.opacity = '0';
  popup.style.transform = 'translate(-50%,-50%) scale(0.95)';
  overlay.style.opacity = '0';
  setTimeout(() => {
    popup.style.display = 'none';
    overlay.style.display = 'none';
  }, 300);
}

function checkWelcome() {
  const dontShow = localStorage.getItem('scientrix_welcome_shown');
  if (!dontShow) {
    showPopup('welcome-modal');
  }
}

function closeWelcome() {
  const dontShow = document.getElementById('dont-show-again').checked;
  if (dontShow) {
    localStorage.setItem('scientrix_welcome_shown', 'true');
  }
  closePopup('welcome-modal');
}

async function handleRegistration(e) {
  e.preventDefault();
  const f = e.target;
  
  const code = generateCode();
  
  try {
    const response = await fetch(SHEETS_API_URL, {
      method: 'POST',
      body: JSON.stringify({
        code: code,
        school: f.school_name.value,
        participant1: f.participant1.value,
        participant2: f.participant2.value || 'N/A',
        participant3: f.participant3.value || 'N/A',
        projectTitle: f.project_title.value,
        category: f.category.value,
        registrant: f.registrant_name.value,
        registrantContact: f.registrant_contact.value,
        participantContact: f.participant_contact.value,
        email: f.email.value,
        projectDesc: f.project_desc.value || 'N/A',
        checkedIn: false,
        checkinTime: ''
      })
    });
    
    closePopup('register-popup');
    document.getElementById('generated-code').textContent = code;
    generateQR(code);
    showPopup('success-popup');
    f.reset();
  } catch (err) {
    alert('Error: ' + err.message);
  }
}

async function checkIn() {
  const code = document.getElementById('checkin-code').value.trim().toUpperCase();
  const resultDiv = document.getElementById('checkin-result');
  
  if (!code) {
    resultDiv.innerHTML = '<div class="status-badge status-error">Please enter a registration code</div>';
    return;
  }
  
  try {
    const response = await fetch(`${SHEETS_API_URL}?code=${code}`);
    const data = await response.json();
    
    if (!data.found) {
      resultDiv.innerHTML = '<div class="status-badge status-error">‚ùå Invalid registration code</div>';
      return;
    }
    
    resultDiv.innerHTML = `
      <div class="status-badge status-success">‚úÖ Valid Registration - ${data.checkedIn ? 'Checked In' : 'Not Checked In'}</div>
      <div class="registration-details">
        <div class="detail-row">
          <span class="detail-label">Registration Code:</span>
          <span class="detail-value">${data.code}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">School:</span>
          <span class="detail-value">${data.school}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Team Lead:</span>
          <span class="detail-value">${data.participant1}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Team Members:</span>
          <span class="detail-value">${data.participant2}, ${data.participant3}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Project:</span>
          <span class="detail-value">${data.projectTitle}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Category:</span>
          <span class="detail-value">${data.category.charAt(0).toUpperCase() + data.category.slice(1)}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Contact:</span>
          <span class="detail-value">${data.participantContact}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Check-in Status:</span>
          <span class="detail-value" style="color:${data.checkedIn ? 'var(--success)' : 'var(--warning)'}">
            ${data.checkedIn ? '‚úÖ Checked In' : '‚è≥ Pending'}
          </span>
        </div>
        ${data.checkinTime ? `
        <div class="detail-row">
          <span class="detail-label">Check-in Time:</span>
          <span class="detail-value">${data.checkinTime}</span>
        </div>
        ` : ''}
      </div>
    `;
  } catch (err) {
    resultDiv.innerHTML = '<div class="status-badge status-error">Error: ' + err.message + '</div>';
  }
}

document.getElementById('checkin-code').addEventListener('keypress', (e) => {
  if (e.key === 'Enter') checkIn();
});

function shareCode() {
  const code = document.getElementById('generated-code').textContent;
  const msg = `üéâ Successfully registered for Scientrix 2025!

üìã Registration Code: ${code}

üìÖ Event Date: November 11, 2025
üè´ Venue: Little Scholars' Academy

‚ö†Ô∏è Save this code for check-in on event day!

Theme: Sustainable Futures üåç`;
  
  const waURL = `https://wa.me/?text=${encodeURIComponent(msg)}`;
  window.open(waURL, '_blank');
}

function downloadQR() {
  const canvas = document.getElementById('qr-canvas');
  const code = document.getElementById('generated-code').textContent;
  const link = document.createElement('a');
  link.download = `scientrix-${code}.png`;
  link.href = canvas.toDataURL();
  link.click();
}

function showAdminLogin() {
  showPopup('admin-login-popup');
}

async function loginAdmin() {
  const password = document.getElementById('admin-password').value;
  if (password === ADMIN_PASSWORD) {
    closePopup('admin-login-popup');
    document.getElementById('admin').style.display = 'block';
    document.getElementById('admin').scrollIntoView({ behavior: 'smooth' });
    await loadAdminData();
  } else {
    alert('Incorrect password!');
  }
}

function logoutAdmin() {
  document.getElementById('admin').style.display = 'none';
  document.getElementById('admin-password').value = '';
}

async function loadAdminData() {
  try {
    const response = await fetch(`${SHEETS_API_URL}?getAll=true`);
    const registrations = await response.json();
    updateAdminTable(registrations);
    updateAdminStats(registrations);
  } catch (err) {
    alert('Error loading data: ' + err.message);
  }
}

function updateAdminStats(registrations) {
  const total = registrations.length;
  const checkedIn = registrations.filter(r => r.checkedIn).length;
  const pending = total - checkedIn;
  
  document.getElementById('total-registrations').textContent = total;
  document.getElementById('checked-in').textContent = checkedIn;
  document.getElementById('pending-checkin').textContent = pending;
}

function updateAdminTable(registrations) {
  const tbody = document.getElementById('admin-tbody');
  tbody.innerHTML = '';
  
  registrations.forEach((reg) => {
    const row = tbody.insertRow();
    row.innerHTML = `
      <td><strong>${reg.code}</strong></td>
      <td>${reg.school}</td>
      <td>${reg.participant1}</td>
      <td>${reg.participantContact}</td>
      <td><span class="status-badge ${reg.checkedIn ? 'status-success' : 'status-error'}" style="display:inline-block">
        ${reg.checkedIn ? '‚úÖ Checked In' : '‚è≥ Pending'}
      </span></td>
    `;
  });
}

overlay.addEventListener('click', () => {
  document.querySelectorAll('.popup').forEach(popup => {
    if (popup.style.display === 'block') {
      closePopup(popup.id);
    }
  });
});

setTimeout(checkWelcome, 500);
</script>
</body>
</html>
